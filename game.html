<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cheer Up Pastor Peter - Dodge Adventure üéÆ</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            font-family: 'Comic Sans MS', cursive, sans-serif;
            overflow: hidden;
        }
        
        #ui {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1000;
        }
        
        #score {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.9);
            padding: 15px 25px;
            border-radius: 25px;
            font-size: 24px;
            font-weight: bold;
            color: #333;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            pointer-events: auto;
        }
        
        #startBtn {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(45deg, #4CAF50, #8BC34A);
            color: white;
            border: none;
            padding: 20px 40px;
            border-radius: 15px;
            font-size: 24px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            z-index: 1001;
        }
        
        #controls {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 20px;
            pointer-events: auto;
        }
        
        .control-btn {
            background: linear-gradient(45deg, #E91E63, #F06292);
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            min-width: 80px;
            min-height: 50px;
        }
        
        #floatingMessages {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 500;
        }
    </style>
</head>
<body>
    <div id="ui">
        <div id="score">Score: <span id="scoreValue">0</span></div>
        <button id="startBtn">Start Game! üöÄ</button>
        <div id="controls">
            <button class="control-btn" id="leftBtn">‚Üê Left</button>
            <button class="control-btn" id="jumpBtn">Jump! ü¶ò</button>
            <button class="control-btn" id="rightBtn">Right ‚Üí</button>
        </div>
        <div id="floatingMessages"></div>
    </div>
    
    <script>
        console.log('üéÆ Game starting...');
        
        // Check if Three.js loaded
        if (typeof THREE === 'undefined') {
            console.error('‚ùå Three.js failed to load!');
            document.body.innerHTML = '<div style="color: white; text-align: center; padding: 50px; font-size: 24px;">Three.js failed to load. Please check your internet connection and refresh the page.</div>';
        } else {
            console.log('‚úÖ Three.js loaded successfully!');
        }

        // Game variables
        let scene, camera, renderer, peter, obstacles = [];
        let gameStarted = false;
        let score = 0;
        let currentLane = 1;
        let isJumping = false;
        let gameLoop;
        const lanes = [-3, 0, 3];
        
        // Milla's encouraging messages
        const messages = [
            "You can do it, Pastor Peter! üí™",
            "You're the best! üåü",
            "I'm so proud of you! ü•∞",
            "Keep going, you're amazing! üöÄ",
            "You make me so happy! üòä",
            "You're incredibly talented! üé®",
            "I love watching you play! üíï",
            "You're my favorite person! ü•∞",
            "You're doing great! Keep going! üöÄ",
            "I believe in you completely! ‚ú®"
        ];
        
        function init() {
            console.log('üöÄ Initializing...');
            
            try {
                // Create scene
                scene = new THREE.Scene();
                scene.background = new THREE.Color(0x87CEEB);
                console.log('‚úÖ Scene created');
                
                // Create camera
                camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
                camera.position.set(0, 5, 15);
                camera.lookAt(0, 0, 0);
                console.log('‚úÖ Camera created');
                
                // Create renderer
                renderer = new THREE.WebGLRenderer();
                renderer.setSize(window.innerWidth, window.innerHeight);
                document.body.appendChild(renderer.domElement);
                console.log('‚úÖ Renderer created and added to DOM');
                
                // Create Peter
                createPastorPeter();
                
                // Create ground
                createEnvironment();
                
                // Add lighting
                const light = new THREE.DirectionalLight(0xffffff, 1);
                light.position.set(10, 10, 5);
                scene.add(light);
                console.log('‚úÖ Lighting added');
                
                // Setup controls
                setupControls();
                
                console.log('üéâ Initialization complete!');
                
            } catch (error) {
                console.error('‚ùå Error: ' + error.message);
            }
        }
        
        function createPastorPeter() {
            console.log('üë®‚Äçüíº Creating Pastor Peter...');
            
            // Create a more detailed character
            const group = new THREE.Group();
            
            // Body
            const bodyGeometry = new THREE.BoxGeometry(1, 2, 0.5);
            const bodyMaterial = new THREE.MeshLambertMaterial({ color: 0x4A90E2 });
            const body = new THREE.Mesh(bodyGeometry, bodyMaterial);
            body.position.y = 1;
            group.add(body);
            
            // Head
            const headGeometry = new THREE.SphereGeometry(0.6, 16, 16);
            const headMaterial = new THREE.MeshLambertMaterial({ color: 0xFFE0B2 });
            const head = new THREE.Mesh(headGeometry, headMaterial);
            head.position.y = 2.2;
            group.add(head);
            
            // Arms
            const armGeometry = new THREE.BoxGeometry(0.3, 1.5, 0.3);
            const armMaterial = new THREE.MeshLambertMaterial({ color: 0xFFE0B2 });
            
            const leftArm = new THREE.Mesh(armGeometry, armMaterial);
            leftArm.position.set(-0.8, 1.2, 0);
            group.add(leftArm);
            
            const rightArm = new THREE.Mesh(armGeometry, armMaterial);
            rightArm.position.set(0.8, 1.2, 0);
            group.add(rightArm);
            
            // Legs
            const legGeometry = new THREE.BoxGeometry(0.4, 1.5, 0.4);
            const legMaterial = new THREE.MeshLambertMaterial({ color: 0x2E7D32 });
            
            const leftLeg = new THREE.Mesh(legGeometry, legMaterial);
            leftLeg.position.set(-0.3, -0.5, 0);
            group.add(leftLeg);
            
            const rightLeg = new THREE.Mesh(legGeometry, legMaterial);
            rightLeg.position.set(0.3, -0.5, 0);
            group.add(rightLeg);
            
            peter = group;
            peter.position.set(0, 0, 0);
            scene.add(peter);
            
            console.log('‚úÖ Pastor Peter created!');
        }
        
        function createEnvironment() {
            console.log('üåç Creating environment...');
            
            // Ground
            const groundGeometry = new THREE.PlaneGeometry(20, 1000);
            const groundMaterial = new THREE.MeshLambertMaterial({ color: 0x4CAF50 });
            const ground = new THREE.Mesh(groundGeometry, groundMaterial);
            ground.rotation.x = -Math.PI / 2;
            ground.position.y = 0;
            scene.add(ground);

            // Lane markers
            for (let i = 0; i < 3; i++) {
                const lineGeometry = new THREE.PlaneGeometry(0.2, 1000);
                const lineMaterial = new THREE.MeshLambertMaterial({ color: 0xFFFFFF });
                const line = new THREE.Mesh(lineGeometry, lineMaterial);
                line.rotation.x = -Math.PI / 2;
                line.position.set(lanes[i], 0.01, 0);
                scene.add(line);
            }
            
            console.log('‚úÖ Environment created!');
        }
        
        function createObstacle() {
            const geometry = new THREE.BoxGeometry(1, 2, 1);
            const material = new THREE.MeshLambertMaterial({ color: 0xFF69B4 });
            const obstacle = new THREE.Mesh(geometry, material);
            
            const lane = Math.floor(Math.random() * 3);
            obstacle.position.set(lanes[lane], 1, -20);
            obstacle.userData = { speed: 0.1 };
            scene.add(obstacle);
            obstacles.push(obstacle);
        }
        
        function setupControls() {
            const startBtn = document.getElementById('startBtn');
            const leftBtn = document.getElementById('leftBtn');
            const rightBtn = document.getElementById('rightBtn');
            const jumpBtn = document.getElementById('jumpBtn');

            startBtn.addEventListener('click', startGame);
            leftBtn.addEventListener('click', moveLeft);
            rightBtn.addEventListener('click', moveRight);
            jumpBtn.addEventListener('click', jump);

            // Keyboard controls
            document.addEventListener('keydown', (e) => {
                if (!gameStarted) return;
                
                switch(e.code) {
                    case 'ArrowLeft':
                    case 'KeyA':
                        e.preventDefault();
                        moveLeft();
                        break;
                    case 'ArrowRight':
                    case 'KeyD':
                        e.preventDefault();
                        moveRight();
                        break;
                    case 'Space':
                        e.preventDefault();
                        jump();
                        break;
                }
            });
        }
        
        function startGame() {
            console.log('üéÆ Start button clicked!');
            gameStarted = true;
            document.getElementById('startBtn').style.display = 'none';
            console.log('‚úÖ Game started, starting animation loop...');
            animate();
        }
        
        function moveLeft() {
            if (currentLane > 0 && !isJumping) {
                currentLane--;
                animateMove();
            }
        }

        function moveRight() {
            if (currentLane < 2 && !isJumping) {
                currentLane++;
                animateMove();
            }
        }
        
        function animateMove() {
            if (!peter) return;
            
            const targetX = lanes[currentLane];
            const startX = peter.position.x;
            const duration = 300;
            const startTime = Date.now();

            function animate() {
                const elapsed = Date.now() - startTime;
                const progress = Math.min(elapsed / duration, 1);
                const easeProgress = 1 - Math.pow(1 - progress, 3);
                
                peter.position.x = startX + (targetX - startX) * easeProgress;
                
                if (progress < 1) {
                    requestAnimationFrame(animate);
                }
            }
            animate();
        }
        
        function jump() {
            if (isJumping || !peter || !gameStarted) return;
            
            isJumping = true;
            
            const startY = peter.position.y;
            const jumpHeight = 3;
            const duration = 600;
            const startTime = Date.now();

            function animateJump() {
                const elapsed = Date.now() - startTime;
                const progress = Math.min(elapsed / duration, 1);
                const jumpProgress = Math.sin(progress * Math.PI);
                
                peter.position.y = startY + jumpHeight * jumpProgress;
                peter.rotation.x = progress * Math.PI * 0.1;
                
                if (progress < 1) {
                    requestAnimationFrame(animateJump);
                } else {
                    peter.position.y = startY;
                    peter.rotation.x = 0;
                    isJumping = false;
                }
            }
            animateJump();
        }
        
        function showDodgeMessage() {
            const message = document.createElement('div');
            message.style.position = 'absolute';
            message.style.background = 'rgba(255, 255, 255, 0.9)';
            message.style.padding = '15px 25px';
            message.style.borderRadius = '20px';
            message.style.fontSize = '16px';
            message.style.fontWeight = 'bold';
            message.style.color = '#E91E63';
            message.style.boxShadow = '0 5px 15px rgba(0,0,0,0.2)';
            message.style.left = '50%';
            message.style.top = '30%';
            message.style.transform = 'translate(-50%, -50%)';
            message.style.zIndex = '10';
            message.textContent = 'Nice Dodge! +5! üòé';
            
            document.getElementById('floatingMessages').appendChild(message);
            
            setTimeout(() => {
                message.remove();
            }, 2000);
        }
        
        function showRandomMessage() {
            if (Math.random() < 0.05) {
                const message = document.createElement('div');
                message.style.position = 'absolute';
                message.style.background = 'rgba(255, 255, 255, 0.9)';
                message.style.padding = '15px 25px';
                message.style.borderRadius = '20px';
                message.style.fontSize = '16px';
                message.style.fontWeight = 'bold';
                message.style.color = '#E91E63';
                message.style.boxShadow = '0 5px 15px rgba(0,0,0,0.2)';
                message.style.left = '50%';
                message.style.top = '40%';
                message.style.transform = 'translate(-50%, -50%)';
                message.style.zIndex = '10';
                message.textContent = messages[Math.floor(Math.random() * messages.length)];
                
                document.getElementById('floatingMessages').appendChild(message);
                
                setTimeout(() => {
                    message.remove();
                }, 3000);
            }
        }
        
        function animate() {
            if (!gameStarted) return;
            
            requestAnimationFrame(animate);
            
            // Move obstacles
            obstacles.forEach((obstacle, index) => {
                obstacle.position.z += obstacle.userData.speed;
                obstacle.rotation.y += 0.02;
                
                // Check collision
                if (Math.abs(obstacle.position.x - peter.position.x) < 1 && 
                    Math.abs(obstacle.position.z - peter.position.z) < 1) {
                    console.log('üí• Game Over!');
                    gameStarted = false;
                    document.getElementById('startBtn').style.display = 'block';
                    document.getElementById('startBtn').textContent = 'Game Over! Play Again? üéÆ';
                    return;
                }
                
                // Remove obstacles that passed
                if (obstacle.position.z > 20) {
                    scene.remove(obstacle);
                    obstacles.splice(index, 1);
                    score += 5;
                    document.getElementById('scoreValue').textContent = score;
                    showDodgeMessage();
                }
            });
            
            // Spawn new obstacles
            if (Math.random() < 0.02) {
                createObstacle();
            }
            
            // Show random messages
            showRandomMessage();
            
            renderer.render(scene, camera);
        }
        
        // Initialize when page loads
        window.addEventListener('load', () => {
            console.log('üìÑ Page loaded');
            setTimeout(init, 100);
        });
        
        // Handle window resize
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>
</html>